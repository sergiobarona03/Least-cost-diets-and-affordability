file.choose()
# Cargar bases
year_2018 <- readRDS("C:\\Users\\Portatil\\Desktop\\Least-cost-diets-and-affordability\\Proyecto Interno\\Avances (6 meses)\\Avance 2\\Bases historicas\\2018.rds")
year_2019 <- readRDS("C:\\Users\\Portatil\\Desktop\\Least-cost-diets-and-affordability\\Proyecto Interno\\Avances (6 meses)\\Avance 2\\Bases historicas\\2019.rds")
year_2020 <- readRDS("C:\\Users\\Portatil\\Desktop\\Least-cost-diets-and-affordability\\Proyecto Interno\\Avances (6 meses)\\Avance 2\\Bases historicas\\2020.rds")
year_2021 <- readRDS("C:\\Users\\Portatil\\Desktop\\Least-cost-diets-and-affordability\\Proyecto Interno\\Avances (6 meses)\\Avance 2\\Bases historicas\\2021.rds")
year_2022 <- readRDS("C:\\Users\\Portatil\\Desktop\\Least-cost-diets-and-affordability\\Proyecto Interno\\Avances (6 meses)\\Avance 2\\Bases historicas\\2022.rds")
year_2023 <- readRDS("C:\\Users\\Portatil\\Desktop\\Least-cost-diets-and-affordability\\Proyecto Interno\\Avances (6 meses)\\Avance 2\\Bases historicas\\2023.rds")
year_2024 <- readRDS("C:\\Users\\Portatil\\Desktop\\Least-cost-diets-and-affordability\\Proyecto Interno\\Avances (6 meses)\\Avance 2\\Bases historicas\\2024.rds")
# Crear una lista con todas las bases
lista_bases <- list(year_2018, year_2019, year_2020, year_2021, year_2022, year_2023, year_2024)
# Normalizar columnas
lista_bases <- lapply(lista_bases, function(df) {
if (!"Cod_CPC" %in% colnames(df)) {
df$Cod_CPC <- NA
}
return(df)
})
# Unir todas las bases
dataset <- bind_rows(lista_bases)
library(tidyverse)
dataset <- bind_rows(lista_bases)
# Convertir columnas a formatos correctos
dataset <- dataset %>%
mutate(
Fecha = as.Date(Fecha),
Cantidad_KG = as.numeric(Cantidad_KG)
)
# Cálculo de Q total
bogota <- dataset %>% filter(Ciudad == "Bogotá") %>%
group_by(Year_Month, Ciudad, Grupo, Alimento) %>%
summarise(Cantidad_Total = sum(Cantidad_KG, na.rm = TRUE) / 1000,
.groups = "drop")
# Cálculo de Q total
bogota <- dataset %>% filter(Ciudad == "Bogotá") %>%
mutate(Year_Month = floor_date(Fecha, "month")) %>%
group_by(Year_Month, Ciudad, Grupo, Alimento) %>%
summarise(Cantidad_Total = sum(Cantidad_KG, na.rm = TRUE) / 1000,
.groups = "drop")
View(bogota)
rm(dataset)
head(bogota)
# Distribución en t
datos_1 <- dataset %>%
group_by(Alimento) %>%
mutate(Quintil = ntile(Cantidad_Total, 5)) %>%
ungroup()
# Distribución en t
datos_1 <- bogota %>%
group_by(Alimento) %>%
mutate(Quintil = ntile(Cantidad_Total, 5)) %>%
ungroup()
View(datos_1)
z1 <- datos_1 %>% filter(Alimento == "Zanahoria")
z1_data <- bogota %>% filter(Alimento == "Zanahoria")
View(z1_data)
plot(z1_data$Cantidad_Total, type = "l")
p10 <- quantile(z1_data$Cantidad_Total, 0.10)
p10
plot(z1_data$Cantidad_Total, type = "l")
lines(p10)
plot(z1_data$Cantidad_Total, type = "l")
line(p10, add = TRUE)
plot(z1_data$Cantidad_Total, type = "l")
lines(p10, type = "l", col = "red")
lines(y = p10, type = "l", col = "red")
plot(z1_data$Cantidad_Total, type = "l")
lines(y = p10, type = "l", col = "red")
plot(z1_data$Cantidad_Total, type = "l")
abline(p10, type = "l", col = "red")
plot(z1_data$Cantidad_Total, type = "l")
abline(h = p10, col = "red")
p5 <- quantile(z1_data$Cantidad_Total, 0.05)
plot(z1_data$Cantidad_Total, type = "l")
abline(h = p5, col = "red")
plot(density(z1_data$Cantidad_Total))
plot(density(z1_data$Cantidad_Total))
abline(v = p5, col = "red")
plot(z1_data$Cantidad_Total, type = "l")
abline(h = p5, col = "red")
levels(as.factor(bogota))
levels(as.factor(bogota$Alimento))
z1_data <- bogota %>% filter(Alimento == "Sal yodada")
p5 <- quantile(z1_data$Cantidad_Total, 0.05)
plot(z1_data$Cantidad_Total, type = "l")
abline(h = p5, col = "red")
p10 <- quantile(z1_data$Cantidad_Total, 0.1)
plot(z1_data$Cantidad_Total, type = "l")
plot(z1_data$Cantidad_Total, type = "l")
abline(h = p5, col = "red")
z1_data
ggplot(z1_data, aes(x = Year_Month,
y = Cantidad_Total)) +
geom_line() +
geom_hline(p10, col = "red")
ggplot(z1_data, aes(x = Year_Month,
y = Cantidad_Total)) +
geom_line()
ggplot(z1_data, aes(x = Year_Month,
y = Cantidad_Total)) +
geom_line() +
geom_hline(yintercept =p10, col = "red")
##---------------------##
## Distribución en i   ##
##---------------------##
datos_2 <- dataset %>%
mutate(Year_Month = floor_date(Fecha, "month")) %>% mutate(
Quintil = ntile(Cantidad_Total, 5)
) %>%
ungroup()
##---------------------##
## Distribución en i   ##
##---------------------##
datos_2 <- bogota %>%
mutate(Year_Month = floor_date(Fecha, "month")) %>% mutate(
Quintil = ntile(Cantidad_Total, 5)
) %>%
ungroup()
##---------------------##
## Distribución en i   ##
##---------------------##
datos_2 <- bogota %>% mutate(
Quintil = ntile(Cantidad_Total, 5)
) %>%
ungroup()
datos_2
View(datos_2)
z2_data <- datos_2 %>% filter(Year_Month == "2018-01-01")
z2_data
ggplot(z2_data, aes(x = Alimento, y = Cantidad_Total)) +
geom_bar()
ggplot(z2_data, aes(x = Alimento, y = Cantidad_Total)) +
geom_point()
ggplot(z2_data, aes(x = Alimento, y = Cantidad_Total)) +
geom_point() +coord_flip()
plotly(z2_data, x = ~Alimento, y = ~Cantidad_Total)
library(plotly)
install.packages("plotly")
plotly(z2_data, x = ~Alimento, y = ~Cantidad_Total)
library(plotly)
plotly(z2_data, x = ~Alimento, y = ~Cantidad_Total)
plotly(data = z2_data, x = ~Alimento, y = ~Cantidad_Total)
z2_data$Cantidad_Total
plotly::plotly(data = z2_data, x = ~Alimento, y = ~Cantidad_Total)
fig1 <- plotly(data = z2_data, x = ~Alimento, y = ~Cantidad_Total)
fig1 <- plot_ly(data = z2_data, x = ~Alimento, y = ~Cantidad_Total)
fig1
plot_ly(data = z2_data, x = ~Alimento, y = ~Cantidad_Total)
plot_ly(data = z2_data, y = ~Alimento, x = ~Cantidad_Total)
z2_exclude
p10 <- quantile(z2_data$Cantidad_Total,0.10)
add_hline(y=p10)
plot_ly(data = z2_data, y = ~Alimento, x = ~Cantidad_Total) %>%
layout(plot_bgcolor = "#e5ecf6",
shapes = list(vline(2.5),
list(type = "rect",
fillcolor = "red",
line = list(color = "red"),
opacity = 0.2,
y0 = p10)))
View(z2_data)
list(type = "line",
x0 = 0,
x1 = 1,
xref = "paper",
y0 = p10,
y1 = p10,
line = list(color = color))
hline <- function(y = 0, color = "red"){
list(type = "line",
x0 = 0,
x1 = 1,
xref = "paper",
y0 = p10,
y1 = p10,
line = list(color = color))
}
hline <- function(y = 0, color = "red"){
list(type = "line",
x0 = 0,
x1 = 1,
xref = "paper",
y0 = y,
y1 = y,
line = list(color = color))
}
plot_ly(data = z2_data, y = ~Alimento, x = ~Cantidad_Total) %>%
layout(shapes = list(hline(p10)))
vline <- function(x = 0, color = "red"){
list(type = "line",
y0 = 0,
y1 = 1,
yref = "paper",
x0 = y,
x1 = y,
line = list(color = color))
}
plot_ly(data = z2_data, y = ~Alimento, x = ~Cantidad_Total) %>%
layout(shapes = list(vline(p10)))
vline <- function(x = 0, color = "red"){
list(type = "line",
y0 = 0,
y1 = 1,
yref = "paper",
x0 = y,
x1 = y,
line = list(color = color))
}
vline <- function(x = 0, color = "red"){
list(type = "line",
y0 = 0,
y1 = 1,
yref = "paper",
x0 = x,
x1 = x,
line = list(color = color))
}
plot_ly(data = z2_data, y = ~Alimento, x = ~Cantidad_Total) %>%
layout(shapes = list(vline(p10)))
plot_ly(data = z2_data %>% filter(Cantidad_Total < p20), y = ~Alimento, x = ~Cantidad_Total) %>%
layout(shapes = list(vline(p10)))
p20 <- quantile(z2_data$Cantidad_Total,0.20)
plot_ly(data = z2_data %>% filter(Cantidad_Total < p20), y = ~Alimento, x = ~Cantidad_Total) %>%
layout(shapes = list(vline(p10)))
z1_data <- bogota %>% filter(Alimento == "Zanahoria")
p10 <- quantile(z1_data$Cantidad_Total, 0.1)
ggplot(z1_data, aes(x = Year_Month,
y = Cantidad_Total)) +
geom_line() +
geom_hline(yintercept =p10, col = "red")
levels(as.factor(bogota$Alimento))
z1_data <- bogota %>% filter(Alimento == "Uchuva")
p10 <- quantile(z1_data$Cantidad_Total, 0.1)
ggplot(z1_data, aes(x = Year_Month,
y = Cantidad_Total)) +
geom_line() +
geom_hline(yintercept =p10, col = "red")
z1_data <- bogota %>% filter(Alimento == "Mango Yulima")
p10 <- quantile(z1_data$Cantidad_Total, 0.1)
ggplot(z1_data, aes(x = Year_Month,
y = Cantidad_Total)) +
geom_line() +
geom_hline(yintercept =p10, col = "red")
##---------------------##
## Distribución en i   ##
##---------------------##
datos_2 <- bogota %>% mutate(
Quintil = ntile(Cantidad_Total, 5)
) %>%
ungroup()
z2_data <- datos_2 %>% filter(Year_Month == "2018-01-01")
p10 <- quantile(z2_data$Cantidad_Total,0.10)
p20 <- quantile(z2_data$Cantidad_Total,0.20)
library(plotly)
vline <- function(x = 0, color = "red"){
list(type = "line",
y0 = 0,
y1 = 1,
yref = "paper",
x0 = x,
x1 = x,
line = list(color = color))
}
plot_ly(data = z2_data %>% filter(Cantidad_Total < p20), y = ~Alimento, x = ~Cantidad_Total) %>%
layout(shapes = list(vline(p10)))
z1_data <- bogota %>% filter(Alimento == "Mango Yulima")
p10 <- quantile(z1_data$Cantidad_Total, 0.1)
ggplot(z1_data, aes(x = Year_Month,
y = Cantidad_Total)) +
geom_line() +
geom_hline(yintercept =p10, col = "red")
z1_data <- bogota %>% filter(Alimento == "Zanahoria")
p10 <- quantile(z1_data$Cantidad_Total, 0.1)
ggplot(z1_data, aes(x = Year_Month,
y = Cantidad_Total)) +
geom_line() +
geom_hline(yintercept =p10, col = "red")
y = scale(Cantidad_Total)) +
ggplot(z1_data, aes(x = Year_Month,
y = scale(Cantidad_Total))) +
geom_line() +
geom_hline(yintercept =p10, col = "red")
ggplot(z1_data, aes(x = Year_Month,
y = scale(Cantidad_Total))) +
geom_line()
ggplot(z1_data, aes(x = Year_Month,
y = scale(Cantidad_Total))) +
geom_line(yintercept = 3)+
geom_line(yintercept = -3)
ggplot(z1_data, aes(x = Year_Month,
y = scale(Cantidad_Total))) +
geom_line(yintercept = 3)+
geom_line(yintercept = -3) + ylim(-4,4)
ggplot(z1_data, aes(x = Year_Month,
y = scale(Cantidad_Total))) +
geom_line() +
geom_hline(yintercept = 3) +
geom_hline(yintercept = -3)
ggplot(z1_data, aes(x = Year_Month,
y = scale(Cantidad_Total))) +
geom_line() +
geom_hline(yintercept = 3, col = "red") +
geom_hline(yintercept = -3, col = "red")
z1_data <- bogota %>% filter(Alimento == "Sal yodada")
p10 <- quantile(z1_data$Cantidad_Total, 0.1)
ggplot(z1_data, aes(x = Year_Month,
y = scale(Cantidad_Total))) +
geom_line() +
geom_hline(yintercept = -3, col = "red")
z1_data <- bogota %>% filter(Alimento == "Sal yodada")
p10 <- quantile(z1_data$Cantidad_Total, 0.1)
ggplot(z1_data, aes(x = Year_Month,
y = scale(Cantidad_Total))) +
geom_line() +
geom_hline(yintercept = -3, col = "red")
levels(as.factor(bogota$Alimento))
z1_data <- bogota %>% filter(Alimento == "Tomate chonto")
p10 <- quantile(z1_data$Cantidad_Total, 0.1)
ggplot(z1_data, aes(x = Year_Month,
y = scale(Cantidad_Total))) +
geom_line() +
geom_hline(yintercept = -3, col = "red")
z1_data <- bogota %>% filter(Alimento == "Uchuva")
p10 <- quantile(z1_data$Cantidad_Total, 0.1)
ggplot(z1_data, aes(x = Year_Month,
y = scale(Cantidad_Total))) +
geom_line() +
geom_hline(yintercept = -3, col = "red")
z1_data <- bogota %>% filter(Alimento == "Acelga")
p10 <- quantile(z1_data$Cantidad_Total, 0.1)
ggplot(z1_data, aes(x = Year_Month,
y = scale(Cantidad_Total))) +
geom_line() +
geom_hline(yintercept = -3, col = "red")
z1_data <- bogota %>% filter(Alimento == "Granos secos")
p10 <- quantile(z1_data$Cantidad_Total, 0.1)
ggplot(z1_data, aes(x = Year_Month,
y = scale(Cantidad_Total))) +
geom_line() +
geom_hline(yintercept = -3, col = "red")
z1_data <- bogota %>% filter(Alimento == "Granos secos")
z1_data
z1_data <- bogota %>% filter(Alimento == "Granos Secos")
p10 <- quantile(z1_data$Cantidad_Total, 0.1)
ggplot(z1_data, aes(x = Year_Month,
y = scale(Cantidad_Total))) +
geom_line() +
geom_hline(yintercept = -3, col = "red")
z1_data <- bogota %>% filter(Alimento == "Papa capira")
p10 <- quantile(z1_data$Cantidad_Total, 0.1)
ggplot(z1_data, aes(x = Year_Month,
y = scale(Cantidad_Total))) +
geom_line() +
geom_hline(yintercept = -3, col = "red")
z1_data <- bogota %>% filter(Alimento == "Zanahoria")
z1_data
View(z1_data)
z1_data$Year_Month
ts_z1 = ts(z1_data$Cantidad_Total,
frequency = 12, start = c(2018, 1))
ts_z1
ts_decompose = decompose(ts_z1)
plot.ts(ts_decompose$seasonal)
View(bogota)
length(levels(as.factor(bogota$Alimento)))
ggplot(z1_data, aes(x = Year_Month,
y = scale(Cantidad_Total))) +
geom_line() +
geom_hline(yintercept = -3, col = "red")
z1_data <- bogota %>% filter(Alimento == "Zanahoria")
ts_z1 = ts(z1_data$Cantidad_Total,
frequency = 12, start = c(2018, 1))
ts_decompose = decompose(ts_z1)
plot.ts(ts_decompose$seasonal)
p10 <- quantile(z1_data$Cantidad_Total, 0.1)
ggplot(z1_data, aes(x = Year_Month,
y = scale(Cantidad_Total))) +
geom_line() +
geom_hline(yintercept = -3, col = "red")
z1_data <- bogota %>% filter(Alimento == "Zanahoria")
ts_z1 = ts(z1_data$Cantidad_Total,
frequency = 12, start = c(2018, 1))
ggplot(z1_data, aes(x = Year_Month,
y = scale(Cantidad_Total))) +
geom_line()
ggplot(z1_data, aes(x = Year_Month,
y = (Cantidad_Total))) +
geom_line()
ggplot(z1_data, aes(x = Year_Month,
y = scale(Cantidad_Total))) +
geom_line() +
geom_hline(yintercept = -3, col = "red")
z1_data <- bogota %>% filter(Alimento == "Mango Yulima")
ts_z1 = ts(z1_data$Cantidad_Total,
frequency = 12, start = c(2018, 1))
ts_decompose = decompose(ts_z1)
plot.ts(ts_decompose$seasonal)
plot.ts(ts_z1)
##--------------------##
## Distribución en t  ##
##--------------------##
library(seasonal)
ts_z1
seas_z1 <- seas(ts_z1)
##--------------------##
## Distribución en t  ##
##--------------------##
library(seasonal)
install.packages("seasonal")
seas_z1 <- seas(ts_z1)
##--------------------##
## Distribución en t  ##
##--------------------##
library(seasonal)
seas_z1 <- seas(ts_z1)
plot.ts(predict(seas_z1))
plot.ts(final(seas_z1))
seas_z1 <- final(seas(ts_z1))
p10 <- quantile(seas_z1, 0,1)
plot.ts(final(seas_z1))
abline(h = p10, col = "red")
plot.ts((seas_z1))
plot.ts((seas_z1))
abline(h = p10, col = "red")
levels(as.factor(bogota$Alimento))
z1_data <- bogota %>% filter(Alimento == "Ñame")
ts_z1 = ts(z1_data$Cantidad_Total,
frequency = 12, start = c(2018, 1))
ts_decompose = decompose(ts_z1)
plot.ts(ts_z1)
plot.ts(ts_z1)
plot.ts(ts_z1)
p10 <- quantile(seas_z1, 0,1)
plot.ts((seas_z1))
abline(h = p10, col = "red")
z1_data <- bogota %>% filter(Alimento == "Ñame")
ts_z1 = ts(z1_data$Cantidad_Total,
frequency = 12, start = c(2018, 1))
ts_decompose = decompose(ts_z1)
z1_data <- bogota %>% filter(Alimento == "Ñame")
z1_data <- bogota %>% filter(Alimento == "Ñame")
p10 <- quantile(z1_data$Cantidad_Total, 0.10)
ggplot(z1_data, aes(x = Year_Month,
y = scale(Cantidad_Total))) +
geom_line() +
geom_hline(yintercept = -3, col = "red")
